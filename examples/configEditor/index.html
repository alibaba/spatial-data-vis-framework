<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Example</title>
		<link rel="shortcut icon" href="#" />
		<link
			rel="stylesheet"
			data-name="vs/editor/editor.main"
			href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.38.0/min/vs/editor/editor.main.min.css"
			integrity="sha512-4NEblFMNWFhMblfSYEN42smVgSrpZpFArYPcc3L++DEPDq0fJL76rHBGpUxDHXNAdvWowZCl9YUota2JgURP/A=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>
		<script>
			var require = {
				paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.38.0/min/vs' },
			}
		</script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.38.0/min/vs/loader.min.js"
			integrity="sha512-A+6SvPGkIN9Rf0mUXmW4xh7rDvALXf/f0VtOUiHlDUSPknu2kcfz1KzLpOJyL2pO+nZS13hhIjLqVgiQExLJrw=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.38.0/min/vs/editor/editor.main.nls.min.js"
			integrity="sha512-Wh1IqsQjsDh/6M05PcBe/zv9zaVbzZgRHXADM1Plk9bx491+vTqSy6TOU2fFhMNMRkWG56wcW0rYJuVqQUiqxw=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.38.0/min/vs/editor/editor.main.js"
			integrity="sha512-qqldfuKGLz7DiKx5P1fMP2r6Zs2PlKqUiaXmkel8/PWghyoNWStvPPRI/1YbvuBviQP6ZlMCgFssqnqVfgqdsw=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				background-color: #1f1f1f;
				height: 100vh;
				width: 100vw;
				position: relative;
			}

			.wrapper {
				height: 100%;
				width: 100%;

				display: grid;
				grid-template-columns: 2fr 3fr;
				gap: 10px;
			}

			.wrapper > section {
				/* @fix: 允许 item 比 content 小 */
				min-height: 0;
				min-width: 0;

				position: relative;

				display: grid;
				grid-template-rows: 1fr;
				grid-template-columns: 1fr;
			}

			button {
				padding: 0 10px;
				font-size: 14px;

				position: absolute;
				top: 10px;
				right: 10px;

				z-index: 999999;
			}

			#configViewer {
				/* width: 100%;
				height: 100%; */

				border: none;
				outline: none;
				background-color: transparent;
				-webkit-box-shadow: none;
				-moz-box-shadow: none;
				box-shadow: none;

				resize: none; /*remove the resize handle on the bottom right*/

				/* 横向滚动 */
				white-space: pre;
				overflow-wrap: normal;
				overflow-x: scroll;

				background-color: rgb(43, 43, 43);
				color: rgb(226, 226, 226);
				font-weight: bolder;
				font-size: 12px;

				padding: 5px 10px;
				tab-size: 4;
			}

			#container {
				background-color: #20222b;
				transform: scale(0.75);
				transform-origin: top left;
			}

			#container::after {
				content: 'scale(0.75)';
				position: absolute;
				right: 0;
				bottom: 0;
				color: white;
				font-size: 17px;
			}
		</style>
		<script>
			const entryName = new URL(location.href).searchParams.get('entryName')
			if (entryName) document.title += `: ${entryName}`
		</script>
	</head>
	<body>
		<div class="wrapper">
			<section>
				<button id="applyConfig">使用该配置</button>
				<!-- <textarea id="configViewer"></textarea> -->
				<div id="configViewer"></div>
			</section>
			<section>
				<div id="container"></div>
			</section>
		</div>
		<script type="module">
			import { App } from '../../src/apps/App.ts'
			import { BPConfig } from '../../src/config/template.ts'

			const container = document.getElementById('container')

			console.log(BPConfig)

			const polarisApp = new App(container, BPConfig)

			const editor = monaco.editor.create(configViewer, {
				value: JSON.stringify(BPConfig, null, '\t'),
				language: 'json',
				theme: 'vs-dark',
			})

			// 现实 config json
			// configViewer.value = JSON.stringify(BPConfig, null, '\t')

			// 调试用，手工修改 FBI 侧配置
			applyConfig.onclick = () => {
				try {
					JSON.parse(editor.getValue())
				} catch (error) {
					console.error(error)
					alert('配置格式错误')
				}
				const newConfig = JSON.parse(editor.getValue())
				polarisApp.configManager.setConfig(newConfig)
			}

			// enjoy✨
		</script>

		<script></script>
	</body>
</html>
